<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Pierce A. Wallar — Home</title>

  <!-- Theme boot: default to light, only use dark if saved -->
  <script>
    (function () {
      const d = document.documentElement;
      d.classList.add('no-theme-transitions');
      let saved = null;
      try { saved = localStorage.getItem('theme'); } catch {}
      d.setAttribute('data-theme', saved === 'dark' ? 'dark' : 'light');
    })();
  </script>

  <meta name="color-scheme" content="light dark">
  <link rel="stylesheet" href="css/styles.css"/>
  <link rel="icon" href="assets/images/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="assets/images/favicon.png" sizes="32x32">
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
  <meta name="theme-color" content="#ffffff">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="canonical" href="https://buffalocodes.github.io/PersonalWebpage/index.html">
  <meta name="robots" content="index, follow">
</head>

<body class="bookshelf">
  <nav class="navbar">
    <div class="navbar-left">
      <img src="assets/images/logo.png" alt="Logo">
      <span>Pierce A. Wallar</span>
    </div>

    <!-- Mobile toggle -->
    <button class="nav-toggle" id="navToggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="navMenu">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <line x1="3" y1="6"  x2="21" y2="6"  stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
        <line x1="3" y1="12" x2="21" y2="12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
        <line x1="3" y1="18" x2="21" y2="18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
      </svg>
    </button>

    <div class="navbar-right" id="navMenu">
      <a href="index.html">Home</a>
      <!-- <a href="experience.html">Experience</a> -->
      <a href="projects.html">Projects</a>
      <a href="bookshelf.html" class="active">Bookshelf</a>
      <!-- <a href="contact.html">Contact</a> -->

      <button class="theme-btn" id="themeToggle" aria-label="Toggle dark mode" aria-pressed="false">
        <svg class="icon-moon" width="26" height="26" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" fill="currentColor"/></svg>
        <svg class="icon-sun" width="26" height="26" viewBox="0 0 24 24" aria-hidden="true"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zM1 13h3v-2H1v2zm9-9h2V1h-2v3zm7.04.46l1.79-1.8-1.41-1.41-1.8 1.79 1.42 1.42zM17 13h3v-2h-3v2zM11 23h2v-3h-2v3zM4.22 19.78l1.41 1.41 1.8-1.79-1.42-1.42-1.79 1.8zM19.78 19.78l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zM12 8a4 4 0 100 8 4 4 0 000-8z" fill="currentColor"/></svg>
      </button>

      <!-- <button class="search-btn" id="openSearch" aria-label="Search">...</button> -->
    </div>
  </nav>

  <!-- Search modal -->
  <div class="search-modal" id="searchModal" aria-hidden="true">
    <div class="search-panel" role="dialog" aria-modal="true" aria-labelledby="searchTitle">
      <h2 id="searchTitle">Search this site</h2>
      <form id="siteSearchForm" class="search-row" role="search">
        <input id="q" name="q" type="search" placeholder="Type and press Enter" aria-label="Search">
        <button type="submit">Search</button>
        <button type="button" class="search-close" id="closeSearch" aria-label="Close">Close</button>
      </form>
    </div>
  </div>

  <header class="page_head">
    <h1>Bookshelf</h1>
    <p class="disclosure">A collection of books I’m reading, studying, or just keeping on hand for reference.</p>
  </header>

  <!-- Filter pills like Projects -->
  <nav class="proj_filters" aria-label="Genre filters">
    <button class="pill is-active" data-genre="">All</button>
    <span id="genre-pills"></span>
    <label style="margin-left:1rem">
      <input id="bookshelfQ" type="search" placeholder="Search title or author" aria-label="Search books" />
    </label>
  </nav>

  <main id="books" class="proj_grid"></main>

  <template id="tpl-card">
    <article class="proj_card">
      <div class="proj_thumb">
        <img alt="" loading="lazy" />
      </div>
      <header class="proj_head">
        <h2 class="proj_title"></h2>
        <span class="proj_kind"></span>
      </header>
      <p class="proj_one"></p>
      <div class="proj_tags"></div>
      <footer class="proj_foot">
        <a class="proj_link" target="_blank" rel="noopener">View on Amazon</a>
      </footer>
    </article>
  </template>

<script>
  const DATA_URL = "assets/json/bookshelf.json";
  const AMAZON_TAG = "yourtag-20";

  function withAmazonTag(url) {
    try {
      const u = new URL(url);
      if (u.hostname.includes("amazon.") && !u.searchParams.has("tag")) {
        u.searchParams.set("tag", AMAZON_TAG);
      }
      return u.toString();
    } catch {
      return url;
    }
  }

  // Helpers
  function cleanISBN(v) {
    if (!v) return "";
    const s = String(v).trim();
    if (s === '=""' || s === '=\"\"' || s === '""' || s === "0") return "";
    return s.replace(/[^0-9Xx]/g, "");
  }

  function coverUrl(isbn13, isbn, img) {
    if (img && img.trim()) return img.trim();
    const id = cleanISBN(isbn13) || cleanISBN(isbn);
    if (id) return `https://covers.openlibrary.org/b/isbn/${id}-L.jpg?default=false`;
    return "data:image/svg+xml;charset=utf8," + encodeURIComponent(
      `<svg xmlns='http://www.w3.org/2000/svg' width='400' height='600'>
         <rect width='100%' height='100%' fill='#f3f3f3'/>
         <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#777' font-family='sans-serif' font-size='18'>No cover</text>
       </svg>`
    );
  }

  function normalize(raw) {
    const title = String(raw.title || "").trim();
    const author = String(raw.author || "").trim();
    const year = raw.year ? Number(raw.year) : "";

    // Multi genre support with fallback
    const genres = Array.isArray(raw.genres)
      ? raw.genres.map(g => String(g || "").trim()).filter(Boolean)
      : (raw.genres ? [String(raw.genres).trim()] : []);
    const genre = genres[0] || "";

    const isbn13 = cleanISBN(raw.isbn13 || "");
    const isbn = cleanISBN(raw.isbn || "");

    let url = String(raw.amazon_search_url || "").trim();
    if (!url || url.includes("%3D%22%22")) {
      const q = isbn13 || isbn || `${title} ${author}`.trim();
      url = q ? `https://www.amazon.com/s?k=${encodeURIComponent(q)}` : "";
    }

    return { title, author, year, genres, genre, isbn13, isbn, img: String(raw.img || "").trim(), url };
  }

  function buildCard(b) {
    const n = normalize(b);
    const tpl = document.getElementById("tpl-card").content.firstElementChild.cloneNode(true);

    // Data hooks
    tpl.dataset.genre = (n.genres && n.genres.length ? n.genres.join(",").toLowerCase() : (n.genre || "")).toLowerCase();
    tpl.dataset.author = n.author.toLowerCase();
    tpl.dataset.title = n.title.toLowerCase();

    const img = tpl.querySelector("img");
    const title = tpl.querySelector(".proj_title");
    const kind = tpl.querySelector(".proj_kind");
    const one = tpl.querySelector(".proj_one");
    const tags = tpl.querySelector(".proj_tags");
    const link = tpl.querySelector(".proj_link");

    img.src = coverUrl(n.isbn13, n.isbn, n.img);
    img.alt = `${n.title} by ${n.author}`;

    title.textContent = n.title;
    title.title = n.title;
    kind.textContent = n.genre || "Book";
    one.textContent = n.year ? `${n.author} · ${n.year}` : n.author;

    tags.innerHTML = "";
    if (n.genres && n.genres.length) {
      n.genres.forEach(g => {
        const t = document.createElement("span");
        t.className = "proj_tag";
        t.textContent = g;
        tags.appendChild(t);
      });
    } else if (n.genre) {
      const t = document.createElement("span");
      t.className = "proj_tag";
      t.textContent = n.genre;
      tags.appendChild(t);
    }
    if (n.year) {
      const t = document.createElement("span");
      t.className = "proj_tag";
      t.textContent = String(n.year);
      tags.appendChild(t);
    }

    link.href = withAmazonTag(n.url);
    link.addEventListener("click", () => {
      if (window.gtag) {
        window.gtag("event", "book_click", {
          book_title: n.title,
          book_author: n.author,
          book_genre: (n.genres && n.genres.length ? n.genres.join(", ") : n.genre) || "(none)"
        });
      }
    });

    return tpl;
  }

  function render(list) {
    const grid = document.getElementById("books");
    grid.innerHTML = "";
    for (const b of list) grid.appendChild(buildCard(b));
  }

  function buildPills(data) {
    const set = new Set();
    for (const b of data) {
      const list = Array.isArray(b.genres) && b.genres.length
        ? b.genres
        : (b.genres ? [b.genres] : []);
      for (const g of list) {
        const v = String(g || "").trim().toLowerCase();
        if (v) set.add(v);
      }
    }
    const pills = document.getElementById("genre-pills");
    pills.innerHTML = "";
    [...set].sort().forEach(g => {
      const btn = document.createElement("button");
      btn.className = "pill";
      btn.dataset.genre = g;
      btn.textContent = g.replace(/\b\w/g, c => c.toUpperCase());
      pills.appendChild(btn);
    });
  }

  function applyFiltering(data) {
    const q = document.getElementById("bookshelfQ");
    let activeGenre = "";

    function go() {
      const needle = (q.value || "").trim().toLowerCase();
      const out = data.filter(b => {
        const n = normalize(b);
        const genreOk = !activeGenre || (
          (n.genres && n.genres.some(g => String(g).toLowerCase() === activeGenre)) ||
          (n.genre && n.genre.toLowerCase() === activeGenre)
        );
        const text = `${n.title} ${n.author}`.toLowerCase();
        const qOk = !needle || text.includes(needle);
        return genreOk && qOk;
      });
      render(out);
    }

    document.querySelector(".proj_filters").addEventListener("click", e => {
      const btn = e.target.closest(".pill");
      if (!btn) return;
      document.querySelectorAll(".proj_filters .pill").forEach(b => b.classList.remove("is-active"));
      btn.classList.add("is-active");
      activeGenre = btn.dataset.genre || "";
      go();
    });

    q.addEventListener("input", go);
    go();
  }

  // Sorter for title then author, ignoring leading articles
  function sortBooks(list) {
    const collator = new Intl.Collator(undefined, { sensitivity: "base", numeric: true });
    const strip = s => String(s || "")
      .trim()
      .replace(/^(a |an |the )/i, "")
      .toLowerCase();

    return list.slice().sort((a, b) => {
      const ta = strip(a.title), tb = strip(b.title);
      const byTitle = collator.compare(ta, tb);
      if (byTitle !== 0) return byTitle;
      return collator.compare(strip(a.author), strip(b.author));
    });
  }

  // Load, sort, then initialize UI
  fetch(DATA_URL)
    .then(r => r.json())
    .then(data => {
      const sorted = sortBooks(data);
      buildPills(sorted);
      applyFiltering(sorted);
      render(sorted);
    })
    .catch(err => {
      console.error(err);
      document.getElementById("books").innerHTML =
        "<p style='padding:1rem'>Could not load bookshelf data.</p>";
    });
</script>


  <footer class="site-footer">
    <div class="footer-socials">
      <a href="https://www.linkedin.com/in/pierce-wallar" target="_blank" rel="noopener" aria-label="LinkedIn">
        <svg viewBox="0 0 24 24" class="icon"><path d="M19 0h-14C2.2 0 0 2.2 0 5v14c0 2.8 2.2 5 5 5h14c2.8 0 5-2.2 5-5V5c0-2.8-2.2-5-5-5zM7 19H4V9h3v10zM5.5 7.7C4.1 7.7 3 6.6 3 5.3S4.1 3 5.5 3s2.5 1.1 2.5 2.3S6.9 7.7 5.5 7.7zM21 19h-3v-5.5c0-1.3 0-3-2-3s-2.3 1.5-2.3 2.9V19h-3V9h2.9v1.4h.1c.4-.7 1.4-1.4 3-1.4 3.2 0 3.8 2.1 3.8 4.7V19z"/></svg>
      </a>

      <a href="https://github.com/buffalocodes" target="_blank" rel="noopener" aria-label="GitHub">
        <svg viewBox="0 0 24 24" class="icon"><path d="M12 .5C5.7.5.5 5.7.5 12c0 5.1 3.3 9.4 7.9 10.9.6.1.8-.3.8-.6v-2c-3.2.7-3.9-1.5-3.9-1.5-.5-1.3-1.2-1.6-1.2-1.6-1-.7.1-.7.1-.7 1.1.1 1.6 1.1 1.6 1.1 1 .1.8 1.3 2.7 1.8.5-.4.9-.7 1.2-1-2.6-.3-5.3-1.3-5.3-5.9 0-1.3.5-2.3 1.2-3.1-.1-.3-.5-1.5.1-3.1 0 0 1-.3 3.2 1.2a11.3 11.3 0 0 1 5.9 0c2.2-1.5 3.2-1.2 3.2-1.2.6 1.6.2 2.8.1 3.1.7.8 1.2 1.8 1.2 3.1 0 4.6-2.7 5.6-5.3 5.9.5.4.9 1.1.9 2.2v3.2c0 .3.2.7.8.6 4.7-1.5 7.9-5.8 7.9-10.9C23.5 5.7 18.3.5 12 .5z"/></svg>
      </a>

      <a href="mailto:piercewallar@gmail.com" aria-label="Email">
        <svg viewBox="0 0 24 24" class="icon"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
      </a>
    </div>
  </footer>

  <footer class="site-footer">
    <div class="footer-socials">
      <!-- LinkedIn / GitHub / Email icons -->
    </div>

    <p class="last-updated">
      Last updated: <span id="last-updated">Loading…</span>
    </p>
  </footer>

  <script>
    // Set these once
    const GH_OWNER = "buffalocodes";
    const GH_REPO  = "PersonalWebpage";

    async function setLastUpdatedFromGitHub() {
      const el = document.getElementById("last-updated");
      const fmt = { year: "numeric", month: "long", day: "numeric" };

      try {
        const repoRes = await fetch(`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}`);
        if (!repoRes.ok) throw new Error("Repo lookup failed");
        const repo = await repoRes.json();
        const branch = repo.default_branch || "main";

        const commitsRes = await fetch(
          `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/commits?sha=${encodeURIComponent(branch)}&per_page=1`
        );
        if (!commitsRes.ok) throw new Error("Commits lookup failed");
        const commits = await commitsRes.json();
        const iso = commits[0]?.commit?.author?.date || commits[0]?.commit?.committer?.date;
        if (!iso) throw new Error("No commit date");

        el.textContent = new Date(iso).toLocaleDateString(undefined, fmt);
      } catch (err) {
        try {
          el.textContent = new Date(document.lastModified).toLocaleDateString(undefined, fmt);
        } catch {
          el.textContent = "Unavailable";
        }
      }
    }

    document.addEventListener("DOMContentLoaded", setLastUpdatedFromGitHub);
  </script>

  <script>
    // enable theme toggle and clean up the boot class
    (function () {
      const d = document.documentElement;
      const btn = document.getElementById("themeToggle");

      const now = d.getAttribute("data-theme") === "dark";
      if (btn) btn.setAttribute("aria-pressed", String(now));

      requestAnimationFrame(() => d.classList.remove("no-theme-transitions"));

      if (btn) {
        btn.addEventListener("click", () => {
          const isDark = d.getAttribute("data-theme") === "dark";
          const next = isDark ? "light" : "dark";
          d.setAttribute("data-theme", next);
          try { localStorage.setItem("theme", next); } catch {}
          btn.setAttribute("aria-pressed", String(next === "dark"));
        });
      }
    })();
  </script>

  <script>
    // Nav toggle identical to index.html
    const navToggle = document.getElementById("navToggle");
    const navMenu = document.getElementById("navMenu");
    if (navToggle && navMenu) {
      navToggle.addEventListener("click", () => {
        const isOpen = navMenu.classList.toggle("open");
        navToggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
      });
      navMenu.querySelectorAll("a").forEach(link => {
        link.addEventListener("click", () => {
          navMenu.classList.remove("open");
          navToggle.setAttribute("aria-expanded", "false");
        });
      });
    }
  </script>

  <script>
    // Enable transitions after first paint, like index.html
    window.addEventListener("DOMContentLoaded", () => {
      document.documentElement.classList.remove("no-theme-transitions");
    });
  </script>

</body>
</html>
